const chalk = require("chalk");
const fse = require('fs-extra');
const fs = require("fs");
const path = require('path');
const toml = require('@iarna/toml');
const execSync = require('child_process').execSync;

exports.addEntryPoint = function(name) {
    const root = process.cwd();
    const appPath = path.join(root, "./.bunbuild");

    console.log(chalk.bgCyanBright.black.bold("[Bun Build]")+chalk.bgBlack.blue.italic(" $ Add"));
    if (appPath == root) {
        return;
    }
    if (fse.existsSync(appPath)) {
        const rawBuildFile = toml.parse(fs.readFileSync(appPath));
        if (rawBuildFile["files"].find(x => x === name) == undefined) {
            rawBuildFile["files"].push(name);
            fs.writeFileSync(appPath, "# !bunbuild | Do not edit this file manually; automatically generated.\n"+toml.stringify(rawBuildFile));
            console.log(chalk.bgCyanBright.black.bold("[Bun Build]")+chalk.bgBlack.greenBright(" Successfully Added Entry Point to Bunbuild file"));
        } else {
            console.log(chalk.bgCyanBright.black.bold("[Bun Build]")+chalk.bgBlack.redBright(" Error | This entry point to the Bunbuild file has already been added!"));
        }
    } else {
        console.log(chalk.bgCyanBright.black.bold("[Bun Build]")+chalk.bgBlack.redBright(" Error | Bunbuild file does not exist!"));
        process.exit(1);
    }
}